
======================================================================
HFF-NET EVALUATION WITH METRICS
======================================================================
Log file: ./outputs/logs/eval_log_2025-11-15_17-08-04.txt
Checkpoint: /home/manish/BrainTumorHFF/HFF/result/checkpoints/hff/brats20/all/hff-l=0.3-e=200-s=50-g=0.55-b=1-cw=15-w=3-100L-H-2025-11-14_12-23-36/best_Result2_et_0.8320_tc_0.9098_wt_0.8970.pth
Output directory: ./outputs

[Loading] Model...

[LOADING CHECKPOINT]
Path: /home/manish/BrainTumorHFF/HFF/result/checkpoints/hff/brats20/all/hff-l=0.3-e=200-s=50-g=0.55-b=1-cw=15-w=3-100L-H-2025-11-14_12-23-36/best_Result2_et_0.8320_tc_0.9098_wt_0.8970.pth
Device: cuda
======================================================================
Loading checkpoint from disk...
✓ Checkpoint loaded to CPU

[STEP 1] Identifying checkpoint format...
Checkpoint is a dict with keys: ['module.laplacian_target', 'module.input_ed.conv.weight', 'module.LF_l4_FDCA.semantic_att.linear.0.weight', 'module.LF_l4_FDCA.semantic_att.linear.0.bias', 'module.LF_l4_FDCA.semantic_att.linear.2.weight', 'module.LF_l4_FDCA.semantic_att.linear.2.bias', 'module.LF_l4_FDCA.positional_att.conv.weight', 'module.LF_l4_FDCA.positional_att.conv.bias', 'module.LF_l4_FDCA.slice_att.linear.0.weight', 'module.LF_l4_FDCA.slice_att.linear.0.bias', 'module.LF_l4_FDCA.slice_att.linear.2.weight', 'module.LF_l4_FDCA.slice_att.linear.2.bias', 'module.LF_l4_FDCA.slice_att.mean.weight', 'module.LF_l4_FDCA.slice_att.mean.bias', 'module.LF_l4_FDCA.slice_att.log_diag.weight', 'module.LF_l4_FDCA.slice_att.log_diag.bias', 'module.LF_l4_FDCA.slice_att.factor.weight', 'module.LF_l4_FDCA.slice_att.factor.bias', 'module.LF_l5_FDCA.semantic_att.linear.0.weight', 'module.LF_l5_FDCA.semantic_att.linear.0.bias', 'module.LF_l5_FDCA.semantic_att.linear.2.weight', 'module.LF_l5_FDCA.semantic_att.linear.2.bias', 'module.LF_l5_FDCA.positional_att.conv.weight', 'module.LF_l5_FDCA.positional_att.conv.bias', 'module.LF_l5_FDCA.slice_att.linear.0.weight', 'module.LF_l5_FDCA.slice_att.linear.0.bias', 'module.LF_l5_FDCA.slice_att.linear.2.weight', 'module.LF_l5_FDCA.slice_att.linear.2.bias', 'module.LF_l5_FDCA.slice_att.mean.weight', 'module.LF_l5_FDCA.slice_att.mean.bias', 'module.LF_l5_FDCA.slice_att.log_diag.weight', 'module.LF_l5_FDCA.slice_att.log_diag.bias', 'module.LF_l5_FDCA.slice_att.factor.weight', 'module.LF_l5_FDCA.slice_att.factor.bias', 'module.HF_l4_FDCA.semantic_att.linear.0.weight', 'module.HF_l4_FDCA.semantic_att.linear.0.bias', 'module.HF_l4_FDCA.semantic_att.linear.2.weight', 'module.HF_l4_FDCA.semantic_att.linear.2.bias', 'module.HF_l4_FDCA.positional_att.conv.weight', 'module.HF_l4_FDCA.positional_att.conv.bias', 'module.HF_l4_FDCA.slice_att.linear.0.weight', 'module.HF_l4_FDCA.slice_att.linear.0.bias', 'module.HF_l4_FDCA.slice_att.linear.2.weight', 'module.HF_l4_FDCA.slice_att.linear.2.bias', 'module.HF_l4_FDCA.slice_att.mean.weight', 'module.HF_l4_FDCA.slice_att.mean.bias', 'module.HF_l4_FDCA.slice_att.log_diag.weight', 'module.HF_l4_FDCA.slice_att.log_diag.bias', 'module.HF_l4_FDCA.slice_att.factor.weight', 'module.HF_l4_FDCA.slice_att.factor.bias', 'module.HF_l5_FDCA.semantic_att.linear.0.weight', 'module.HF_l5_FDCA.semantic_att.linear.0.bias', 'module.HF_l5_FDCA.semantic_att.linear.2.weight', 'module.HF_l5_FDCA.semantic_att.linear.2.bias', 'module.HF_l5_FDCA.positional_att.conv.weight', 'module.HF_l5_FDCA.positional_att.conv.bias', 'module.HF_l5_FDCA.slice_att.linear.0.weight', 'module.HF_l5_FDCA.slice_att.linear.0.bias', 'module.HF_l5_FDCA.slice_att.linear.2.weight', 'module.HF_l5_FDCA.slice_att.linear.2.bias', 'module.HF_l5_FDCA.slice_att.mean.weight', 'module.HF_l5_FDCA.slice_att.mean.bias', 'module.HF_l5_FDCA.slice_att.log_diag.weight', 'module.HF_l5_FDCA.slice_att.log_diag.bias', 'module.HF_l5_FDCA.slice_att.factor.weight', 'module.HF_l5_FDCA.slice_att.factor.bias', 'module.mobilenet_encoder_b1.stem.0.weight', 'module.mobilenet_encoder_b1.enc1.conv.0.weight', 'module.mobilenet_encoder_b1.enc1.conv.3.fc1.weight', 'module.mobilenet_encoder_b1.enc1.conv.3.fc1.bias', 'module.mobilenet_encoder_b1.enc1.conv.3.fc2.weight', 'module.mobilenet_encoder_b1.enc1.conv.3.fc2.bias', 'module.mobilenet_encoder_b1.enc1.conv.4.weight', 'module.mobilenet_encoder_b1.enc2.conv.0.weight', 'module.mobilenet_encoder_b1.enc2.conv.3.weight', 'module.mobilenet_encoder_b1.enc2.conv.6.weight', 'module.mobilenet_encoder_b1.enc3.conv.0.weight', 'module.mobilenet_encoder_b1.enc3.conv.3.weight', 'module.mobilenet_encoder_b1.enc3.conv.6.fc1.weight', 'module.mobilenet_encoder_b1.enc3.conv.6.fc1.bias', 'module.mobilenet_encoder_b1.enc3.conv.6.fc2.weight', 'module.mobilenet_encoder_b1.enc3.conv.6.fc2.bias', 'module.mobilenet_encoder_b1.enc3.conv.7.weight', 'module.mobilenet_encoder_b1.enc4.conv.0.weight', 'module.mobilenet_encoder_b1.enc4.conv.3.weight', 'module.mobilenet_encoder_b1.enc4.conv.6.fc1.weight', 'module.mobilenet_encoder_b1.enc4.conv.6.fc1.bias', 'module.mobilenet_encoder_b1.enc4.conv.6.fc2.weight', 'module.mobilenet_encoder_b1.enc4.conv.6.fc2.bias', 'module.mobilenet_encoder_b1.enc4.conv.7.weight', 'module.mobilenet_encoder_b1.enc5.conv.0.weight', 'module.mobilenet_encoder_b1.enc5.conv.3.weight', 'module.mobilenet_encoder_b1.enc5.conv.6.fc1.weight', 'module.mobilenet_encoder_b1.enc5.conv.6.fc1.bias', 'module.mobilenet_encoder_b1.enc5.conv.6.fc2.weight', 'module.mobilenet_encoder_b1.enc5.conv.6.fc2.bias', 'module.mobilenet_encoder_b1.enc5.conv.7.weight', 'module.mobilenet_encoder_b2.stem.0.weight', 'module.mobilenet_encoder_b2.enc1.conv.0.weight', 'module.mobilenet_encoder_b2.enc1.conv.3.fc1.weight', 'module.mobilenet_encoder_b2.enc1.conv.3.fc1.bias', 'module.mobilenet_encoder_b2.enc1.conv.3.fc2.weight', 'module.mobilenet_encoder_b2.enc1.conv.3.fc2.bias', 'module.mobilenet_encoder_b2.enc1.conv.4.weight', 'module.mobilenet_encoder_b2.enc2.conv.0.weight', 'module.mobilenet_encoder_b2.enc2.conv.3.weight', 'module.mobilenet_encoder_b2.enc2.conv.6.weight', 'module.mobilenet_encoder_b2.enc3.conv.0.weight', 'module.mobilenet_encoder_b2.enc3.conv.3.weight', 'module.mobilenet_encoder_b2.enc3.conv.6.fc1.weight', 'module.mobilenet_encoder_b2.enc3.conv.6.fc1.bias', 'module.mobilenet_encoder_b2.enc3.conv.6.fc2.weight', 'module.mobilenet_encoder_b2.enc3.conv.6.fc2.bias', 'module.mobilenet_encoder_b2.enc3.conv.7.weight', 'module.mobilenet_encoder_b2.enc4.conv.0.weight', 'module.mobilenet_encoder_b2.enc4.conv.3.weight', 'module.mobilenet_encoder_b2.enc4.conv.6.fc1.weight', 'module.mobilenet_encoder_b2.enc4.conv.6.fc1.bias', 'module.mobilenet_encoder_b2.enc4.conv.6.fc2.weight', 'module.mobilenet_encoder_b2.enc4.conv.6.fc2.bias', 'module.mobilenet_encoder_b2.enc4.conv.7.weight', 'module.mobilenet_encoder_b2.enc5.conv.0.weight', 'module.mobilenet_encoder_b2.enc5.conv.3.weight', 'module.mobilenet_encoder_b2.enc5.conv.6.fc1.weight', 'module.mobilenet_encoder_b2.enc5.conv.6.fc1.bias', 'module.mobilenet_encoder_b2.enc5.conv.6.fc2.weight', 'module.mobilenet_encoder_b2.enc5.conv.6.fc2.bias', 'module.mobilenet_encoder_b2.enc5.conv.7.weight', 'module.x1_3side.up.1.weight', 'module.x1_3side.up.1.bias', 'module.x1_3side.up.4.weight', 'module.x1_3side.up.4.bias', 'module.x1_3side.up.7.weight', 'module.x1_3side.up.7.bias', 'module.x2_3side.up.1.weight', 'module.x2_3side.up.1.bias', 'module.x2_3side.up.4.weight', 'module.x2_3side.up.4.bias', 'module.x2_3side.up.7.weight', 'module.x2_3side.up.7.bias', 'module.l4_b1_t.transition.0.weight', 'module.l4_b2_t.transition.0.weight', 'module.l5_b1_t.transition.0.weight', 'module.l5_b2_t.transition.0.weight', 'module.l4_b1_2.conv.0.weight', 'module.l4_b1_2.conv.3.weight', 'module.l4_b1_2.conv.6.fc1.weight', 'module.l4_b1_2.conv.6.fc1.bias', 'module.l4_b1_2.conv.6.fc2.weight', 'module.l4_b1_2.conv.6.fc2.bias', 'module.l4_b1_2.conv.7.weight', 'module.l4_b1_d2.down.0.weight', 'module.l4_b1_s.same.0.weight', 'module.l4_b1_3.conv.0.weight', 'module.l4_b1_3.conv.3.weight', 'module.l4_b1_3.conv.6.fc1.weight', 'module.l4_b1_3.conv.6.fc1.bias', 'module.l4_b1_3.conv.6.fc2.weight', 'module.l4_b1_3.conv.6.fc2.bias', 'module.l4_b1_3.conv.7.weight', 'module.l4_b1_4.conv1.weight', 'module.l4_b1_4.conv2.weight', 'module.l4_b1_4.downsample.0.weight', 'module.l4_b1_u.up.1.weight', 'module.l4_b1_u.up.1.bias', 'module.l5_b1_1.conv.0.weight', 'module.l5_b1_1.conv.3.weight', 'module.l5_b1_1.conv.6.fc1.weight', 'module.l5_b1_1.conv.6.fc1.bias', 'module.l5_b1_1.conv.6.fc2.weight', 'module.l5_b1_1.conv.6.fc2.bias', 'module.l5_b1_1.conv.7.weight', 'module.l5_b1_u.up.1.weight', 'module.l5_b1_u.up.1.bias', 'module.l5_b1_s.same.0.weight', 'module.l5_b1_2.conv.0.weight', 'module.l5_b1_2.conv.3.weight', 'module.l5_b1_2.conv.6.fc1.weight', 'module.l5_b1_2.conv.6.fc1.bias', 'module.l5_b1_2.conv.6.fc2.weight', 'module.l5_b1_2.conv.6.fc2.bias', 'module.l5_b1_2.conv.7.weight', 'module.l5_b1_u2.up.1.weight', 'module.l5_b1_u2.up.1.bias', 'module.l3_b1_2.conv1.weight', 'module.l3_b1_2.conv2.weight', 'module.l3_b1_2.downsample.0.weight', 'module.l3_b1_u.up.1.weight', 'module.l3_b1_u.up.1.bias', 'module.l2_b1_2.conv1.weight', 'module.l2_b1_2.conv2.weight', 'module.l2_b1_2.downsample.0.weight', 'module.l2_b1_u.up.1.weight', 'module.l2_b1_u.up.1.bias', 'module.l1_b1_2.conv1.weight', 'module.l1_b1_2.conv2.weight', 'module.l1_b1_2.downsample.0.weight', 'module.l1_b1_f.weight', 'module.l1_b1_f.bias', 'module.l4_b2_2.conv.0.weight', 'module.l4_b2_2.conv.3.weight', 'module.l4_b2_2.conv.6.fc1.weight', 'module.l4_b2_2.conv.6.fc1.bias', 'module.l4_b2_2.conv.6.fc2.weight', 'module.l4_b2_2.conv.6.fc2.bias', 'module.l4_b2_2.conv.7.weight', 'module.l4_b2_d2.down.0.weight', 'module.l4_b2_s.same.0.weight', 'module.l4_b2_3.conv.0.weight', 'module.l4_b2_3.conv.3.weight', 'module.l4_b2_3.conv.6.fc1.weight', 'module.l4_b2_3.conv.6.fc1.bias', 'module.l4_b2_3.conv.6.fc2.weight', 'module.l4_b2_3.conv.6.fc2.bias', 'module.l4_b2_3.conv.7.weight', 'module.l4_b2_4.conv1.weight', 'module.l4_b2_4.conv2.weight', 'module.l4_b2_4.downsample.0.weight', 'module.l4_b2_u.up.1.weight', 'module.l4_b2_u.up.1.bias', 'module.l5_b2_1.conv.0.weight', 'module.l5_b2_1.conv.3.weight', 'module.l5_b2_1.conv.6.fc1.weight', 'module.l5_b2_1.conv.6.fc1.bias', 'module.l5_b2_1.conv.6.fc2.weight', 'module.l5_b2_1.conv.6.fc2.bias', 'module.l5_b2_1.conv.7.weight', 'module.l5_b2_u.up.1.weight', 'module.l5_b2_u.up.1.bias', 'module.l5_b2_s.same.0.weight', 'module.l5_b2_2.conv.0.weight', 'module.l5_b2_2.conv.3.weight', 'module.l5_b2_2.conv.6.fc1.weight', 'module.l5_b2_2.conv.6.fc1.bias', 'module.l5_b2_2.conv.6.fc2.weight', 'module.l5_b2_2.conv.6.fc2.bias', 'module.l5_b2_2.conv.7.weight', 'module.l5_b2_u2.up.1.weight', 'module.l5_b2_u2.up.1.bias', 'module.l3_b2_2.conv1.weight', 'module.l3_b2_2.conv2.weight', 'module.l3_b2_2.downsample.0.weight', 'module.l3_b2_u.up.1.weight', 'module.l3_b2_u.up.1.bias', 'module.l2_b2_2.conv1.weight', 'module.l2_b2_2.conv2.weight', 'module.l2_b2_2.downsample.0.weight', 'module.l2_b2_u.up.1.weight', 'module.l2_b2_u.up.1.bias', 'module.l1_b2_2.conv1.weight', 'module.l1_b2_2.conv2.weight', 'module.l1_b2_2.downsample.0.weight', 'module.l1_b2_f.weight', 'module.l1_b2_f.bias']
ℹ Treating entire checkpoint as state_dict

[STEP 2] Checking for DDP prefix handling...
Sample keys: ['module.laplacian_target', 'module.input_ed.conv.weight', 'module.LF_l4_FDCA.semantic_att.linear.0.weight']
⚠ Detected DDP 'module.' prefix in checkpoint
Removing 'module.' prefix from all keys...
✓ Removed 'module.' from 254 keys

[STEP 3] Loading state_dict into model...
✓ State dict loaded successfully

[STEP 4] Verification...
✓ Model parameters: 26,104,612
✓ Trainable parameters verified: 3+

======================================================================
✅ CHECKPOINT LOADED SUCCESSFULLY
======================================================================

✓ Model loaded successfully
✓ XAI modules initialized
✓ Run output directory: outputs/xai_2025-11-15_17-08-06

[Loading] Data from /home/manish/BrainTumorHFF/HFF/data/brats20/final/0-test.txt
[*] Load /home/manish/BrainTumorHFF/HFF/data/brats20/final/0-test.txt, which contains 38 paired volume
modilities: ['flair_L', 't1_L', 't1ce_L', 't2_L', 'flair_H1', 'flair_H2', 'flair_H3', 'flair_H4', 't1_H1', 't1_H2', 't1_H3', 't1_H4', 't1ce_H1', 't1ce_H2', 't1ce_H3', 't1ce_H4', 't2_H1', 't2_H2', 't2_H3', 't2_H4']
[*] Load /home/manish/BrainTumorHFF/HFF/data/brats20/final/0-test.txt, which contains 38 paired volume
modilities: ['flair_L', 't1_L', 't1ce_L', 't2_L', 'flair_H1', 'flair_H2', 'flair_H3', 'flair_H4', 't1_H1', 't1_H2', 't1_H3', 't1_H4', 't1ce_H1', 't1ce_H2', 't1ce_H3', 't1ce_H4', 't2_H1', 't2_H2', 't2_H3', 't2_H4']
✓ Data loaded: 38 batches

[Starting] Evaluation...
======================================================================
Evaluating:   0%|          | 0/38 [00:00<?, ?it/s]Getting prediction...
  Sample: sample_0000
    class_0: Dice=0.9962, IoU=0.9924
    class_1: Dice=0.7369, IoU=0.5834
    class_2: Dice=0.7294, IoU=0.5741
    class_3: Dice=0.8159, IoU=0.6891
Evaluating:   3%|2         | 1/38 [00:09<06:07,  9.93s/it]Getting prediction...
  Sample: sample_0001
    class_0: Dice=0.9977, IoU=0.9955
    class_1: Dice=0.9023, IoU=0.8220
    class_2: Dice=0.9454, IoU=0.8965
    class_3: Dice=0.9367, IoU=0.8809
Evaluating:   5%|5         | 2/38 [00:14<03:55,  6.53s/it]Getting prediction...
  Sample: sample_0002
    class_0: Dice=0.9970, IoU=0.9940
    class_1: Dice=0.9447, IoU=0.8951
    class_2: Dice=0.6757, IoU=0.5103
    class_3: Dice=0.8275, IoU=0.7058
Evaluating:   8%|7         | 3/38 [00:18<03:10,  5.46s/it]Getting prediction...
  Sample: sample_0003
    class_0: Dice=0.9992, IoU=0.9984
    class_1: Dice=0.4896, IoU=0.3241
    class_2: Dice=0.7833, IoU=0.6437
    class_3: Dice=0.7797, IoU=0.6390
Evaluating:  11%|#         | 4/38 [00:22<02:48,  4.95s/it]Getting prediction...
  Sample: sample_0004
    class_0: Dice=0.9964, IoU=0.9928
    class_1: Dice=0.6903, IoU=0.5270
    class_2: Dice=0.1849, IoU=0.1019
    class_3: Dice=0.4282, IoU=0.2724
Evaluating:  13%|#3        | 5/38 [00:26<02:35,  4.70s/it]Evaluating:  13%|#3        | 5/38 [00:30<03:19,  6.05s/it]


======================================================================
FINAL METRICS SUMMARY
======================================================================

PER-CLASS METRICS (Mean ± Std):
======================================================================

class_0:
  Dice: 0.9973 ± 0.0011
  IoU:  0.9946 ± 0.0022

class_1:
  Dice: 0.7527 ± 0.1629
  IoU:  0.6303 ± 0.2066

class_2:
  Dice: 0.6638 ± 0.2559
  IoU:  0.5453 ± 0.2576

class_3:
  Dice: 0.7576 ± 0.1728
  IoU:  0.6374 ± 0.1999

======================================================================

EVALUATION COMPLETE
======================================================================
Samples evaluated: 5
Output directory: ./outputs
Metrics: YES ✓
======================================================================

